language: smalltalk
sudo: false

os:
  - linux

smalltalk:
  - Pharo-6.1

# Unit tests run the normal pillar tests
# Integration tests test that pillar itself can interact with generated files, pdf generation, etc.
# System tests test that we can install and use pillar as a black box
env:
  matrix:
  - JOB=test TYPE=System ARCHETYPE=book OUTPUT=pdf

install:
  # Pillar installation
  - git clone https://github.com/pillar-markup/pillar.git -b newpipeline  # Clone pillar
  - cd pillar && ./scripts/build.sh && cd ..                              # Run pillar build script. Pillar will be built in `pwd`/build!
  - . pillar/scripts/ci/ensure_latex.sh                                   # Install latex
  - ./pillar/scripts/ci/ensure_book_dependencies.sh                       # Install latex dependencies required by pillar
  
script:
  - ./pillar/build/pillar build pdf

deploy:
- provider: bintray
  file: .bintray.json
  on:
    repo: SquareBracketAssociates/Booklet-PharoWithStyle
  skip_cleanup: true
  user: ducasse
  key:
    secure: aB64nvazqS2Le4M80v3v4dSngAJU0UaCbinV8Jrxzd2WKbW5BxLgZSVwEzNpvcj9jyNl6XVU0ol5bIxrMVo52x2IT67anJAbSoNK3eMWfJ5BarWky4tn+8zMor9T3zj6AQrSNGiHXgKhyKtQme3B9DE3LK82csYrJyCZMYVdLRzC6+OEoLeKd96Qj9KPa4YCkwNOnpKVWq95TykNPlmzN3OCI+ADp0jwPinZGl7ZvaoavcawBgY9g0G+DzydLxVaXIgqNIGH0uP1VfOvPraXgUAqbkgmWLDN7eqFwyIOibJhzBhpXRqYVSLAlhKT18BmePdOH5ViiILe1IJz0LCk7ceN0gM9+LPAW3jCxnCgHCO4jjedrXU4i2qz1vlhgwJwAx0DuFKirX2QtFuF5pyQceQT6HHNwaJFABQJBSfb7vaDUgqCGVVwO4fi+tmnnOVmyKAE6H+PW3HFnv+IVLMIUG3Y0Ti1FLGJK097iUmZvLD1CuRLy5dLkGWFCtj+hfu3q3D+xpMVpnemCZbEPz//Vbc8bS3YxbTLgEOXA8dwZ8PNS3Wouv7HexEQQRuJkx1Ehj2InI0K9tvj4apH83ehTHZTOrQ5VkcLejleir2kJKv2LsnSboyCDdXVb8Yh5MJCKMKjWuBl0QBaHXnXClBYLk4h/a5b1J3FwOt0f/71QA8=
s